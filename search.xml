<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[无线WLAN隧道转发模式下数据的封装以及转发过程]]></title>
    <url>%2F2019%2F06%2F22%2F%E6%97%A0%E7%BA%BFWLAN%E9%9A%A7%E9%81%93%E8%BD%AC%E5%8F%91%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E5%B0%81%E8%A3%85%E4%BB%A5%E5%8F%8A%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[无线WLAN隧道转发模式下数据的封装以及转发过程实验用的拓扑： AP1、AP2的业务vlan为101、102，管理vlan为100，AR路由器作为DHCP服务器为AP和终端分配IP地址、DNS等信息。 vlan100、101、102的网关都在核心交换机上。 核心交换机上做DHCP中继，把AP与终端的dhcp请求转到服务器上。 分别使用直接转发模式和隧道转发模式。 遇到的问题 在进行完正常的配置，AP上线、下发配置后，直接转发模式下的终端连接AP结果正常，但是在改为隧道转发模式后终端却怎么也获取不到IP信息，一直处于正在连接的状态。 当时感到困惑的是，通过wireshark抓包分析发现，这个请求包在并没有按照预想的通过中继来到dhcp服务器这里，进一步分析发现终端的dhcp discover封装了两层的vlan tag，内层为AP的业务vlan，外层为管理vlan，这时才恍然大悟，隧道模式下，数据会通过隧道封装先送到AC在进行处理。而业务vlan在核心交换机也就是网关那里就终结了，AC上并没有这些vlan信息，也不能为终端提供dhcp服务，导致了终端一直处于连接的状态。 这个时候解决问题的思路也就清晰了。 把AC配成dhcp服务器，直接为终端提供服务 在AC上添加业务vlan的信息，把dhcp请求中继到AR路由器上，依旧由AR提供dhcp服务。 通过上述方法配置后，一切就正常了。下面附上华为官方关于两种转发模式的介绍。 业务数据报文直接转发的处理流程如下图所示，直接转发模式下，业务数据报文不经过CAPWAP封装。 上行（STA–&gt;Internet）：AP收到STA的802.11格式的上行业务数据，由AP直接转换为802.3报文并标记业务VLAN s后向目的地发送。 下行（Internet–&gt;STA）：下行业务数据以802.3报文到达AP（由上层网络设备标记业务VLAN s’），由AP转换为802.11格式发送给STA。 中间网络设备需配置和透传业务VLAN s，这种组网模式下，AC一般旁挂在核心交换机或汇聚交换机上，不承担数据业务转发功能，只对AP进行管理。如果AC处于直连位置时，数据报文也需要通过AC进行转发，此时AC可视为承担汇聚交换机功能。 业务数据报文CAPWAP隧道转发的处理流程如下图所示，AP与AC之间同时建立控制隧道和数据隧道，WLAN用户业务数据和管理报文分别封装在CAPWAP数据报文和CAPWAP控制报文中，在CAPWAP隧道中传递。 上行（STA–&gt;Internet）：AP收到STA的802.11格式的上行业务数据，由AP直接转换为802.3报文并标记业务VLAN s，然后AP封装上行业务数据到CAPWAP报文中；由连接AP的交换机标记管理VLAN m；AC接收后解CAPWAP封装并终结VLAN m’。 下行（Internet–&gt;STA）：下行业务数据由AC封装到CAPWAP报文中，AC允许携带VLAN s的报文通过并对该报文标记VLAN m’，由AC标记业务VLAN s和管理VLAN m’；由连接AP的交换机终结VLAN m；由AP接收后解CAPWAP封装并终结VLAN s，并将802.3报文转换为802.11报文发送给STA。 封装后的报文在CAPWAP报文外层使用管理VLAN m，AP与AC之间的网络设备只能透传管理VLAN m，而对封装在CAPWAP报文内的业务VLAN s不能放通。 AC处于直连和旁挂位置时，封装后的数据包都需要由AC处理和转发。]]></content>
      <categories>
        <category>华为</category>
      </categories>
      <tags>
        <tag>wlan</tag>
        <tag>华为</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[nihaoa]]></title>
    <url>%2F2019%2F06%2F22%2Fnihaoa%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2019%2F06%2F22%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
  <entry>
    <title><![CDATA[aaaaa]]></title>
    <url>%2F2017%2F06%2F22%2Faaaaa%2F</url>
    <content type="text"></content>
  </entry>
</search>
